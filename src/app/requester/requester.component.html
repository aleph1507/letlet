<div class="requester-container">
  <div class="req-form-container">
    <form class="requester-form" id="requester-form" (ngSubmit)="onSubmit()" [formGroup]="requesterForm" novalidate>
      <mat-form-field class="requester-field">
        <input matInput
          placeholder="Requester Name"
          id="requesterName"
          name="requesterName"
          formControlName="requesterName"
          autocomplete="off"
          required>
      </mat-form-field>
      <mat-form-field class="requester-field">
        <textarea name="requesterDescription"
          id="requesterDescription"
          matInput placeholder="Description"
          formControlName="requesterDescription"
          autocomplete="off"
        ></textarea>
      </mat-form-field>
      <mat-form-field class="requester-field">
        <textarea name="requesterDescriptionEn"
          id="requesterDescriptionEn"
          matInput placeholder="Description in English"
          formControlName="requesterDescriptionEn"
          autocomplete="off"
        ></textarea>
      </mat-form-field>
      <!-- <mat-form-field class="requester-field">
        <input matInput
          formControlName="requesterCompany"
          [matAutocomplete]="companyAuto"
          name="requesterCompany"
          id="requesterCompany"
          placeholder="Company" required>
          <mat-autocomplete #companyAuto="matAutocomplete">
            <mat-option *ngFor="let company of filteredCompanies | async" [value]="company">
              {{ company.name }}
            </mat-option>
          </mat-autocomplete>
      </mat-form-field> -->
      <!-- <mat-form-field class="requester-field">
        <input matInput type="text" name='requesterCompany'
        id="requesterCompany" placeholder="Company"
        formControlName="requesterCompany"
        [matAutocomplete]="comp"
        required>
      </mat-form-field>
      <mat-autocomplete #comp="matAutocomplete" [displayWith]="displayFn">
          <mat-option *ngFor="let c of companies" [value]="c" >
            {{ c.name }}
          </mat-option>
      </mat-autocomplete> -->
      <mat-form-field class="company-field">
        <input type="text" placeholder="Company" [formControl]="companiesAutoCtrl" matInput [matAutocomplete]="comp_auto">
        <mat-autocomplete #comp_auto="matAutocomplete" [displayWith]="displayFn">
          <mat-option *ngFor="let comp of companies_auto" [value]="comp">
            {{ comp.name }}
          </mat-option>
        </mat-autocomplete>
      </mat-form-field>
      <mat-form-field>
        <input matInput [matDatepicker]="fromPicker" placeholder="From date"
        formControlName="requesterFromDate" required>
        <mat-datepicker-toggle matSuffix [for]="fromPicker"></mat-datepicker-toggle>
        <mat-datepicker #fromPicker></mat-datepicker>
      </mat-form-field>
      <mat-form-field>
        <input matInput [matDatepicker]="toPicker" placeholder="To date"
        formControlName="requesterToDate" required>
        <mat-datepicker-toggle matSuffix [for]="toPicker"></mat-datepicker-toggle>
        <mat-datepicker #toPicker></mat-datepicker>
      </mat-form-field>
      <mat-form-field>
        <mat-select placeholder="Number of entries" formControlName="requesterNumOfEntries"
          name="requesterNumOfEntries" id="requesterNumOfEntries" autocomplete="off" required>
          <!-- <mat-option></mat-option> -->
          <mat-option *ngFor="let e of nEntries" selected [value]="e.value">
            {{e.name}}
          </mat-option>
        </mat-select>
        <!-- <mat-error *ngIf="requesterNumOfEntries.hasError('required')">Please choose a number of allowed entries</mat-error> -->
        <!-- <mat-hint>{{animalControl.value?.sound}}</mat-hint> -->
      </mat-form-field>
      <!-- <mat-form-field *ngIf="editMode">
        <input matInput
          placeholder="Number of entries"
          name="requesterNumberOfEntries"
          formControlName="requesterNumOfEntries"
          autocomplete="off"
          required>
      </mat-form-field> -->
      <div *ngIf="!editMode" class="upload-pdfs">
        <div class="pdf-upload">
          <button type="button" mat-raised-button (click)="pdfUpload1.click()">
            Attach PDF<mat-icon>keyboard_arrow_up</mat-icon>
            <input type="file" hidden #pdfUpload1
            accept="application/pdf"
            (change)="savePdf($event)" name="pdf1" id="pdf1" formControlName="pdf1">
          </button> <span>{{pdf1filename}}</span>
        </div>
        <div class="pdf-upload" style="margin-top:3%;">
          <button type="button" mat-raised-button (click)="pdfUpload2.click()">
            Attach BSR<mat-icon>keyboard_arrow_up</mat-icon>
            <input type="file" hidden #pdfUpload2
            accept="application/pdf"
            (change)="savePdf($event)" name="pdf2" id="pdf2" formControlName="pdf2">
          </button> <span>{{pdf2filename}}</span>
        </div>
      </div>

      <div *ngIf="editMode" class="download-pdfs">
        <a [href]="sanitizeURL(pdfToBlob(this.request.pdf1))" target="_blank">
          <div class="pdf-upload">
            <button type="button" mat-raised-button>
              Download PDF<mat-icon>keyboard_arrow_down</mat-icon>
            </button>
          </div>
        </a>
        <div *ngIf="this.request.pdf2 != null" class="pdf-upload" style="margin-top:3%;">
          <a [href]="sanitizeURL(pdfToBlob(this.request.pdf2))" target="_blank">
            <button type="button" style="margin-bottom: 5em;" mat-raised-button>
              Download Additional PDF<mat-icon>keyboard_arrow_down</mat-icon>
            </button>
          </a>
        </div>
        <button mat-raised-button style="margin:1rem; margin-top: 0;" (click)="printRequest()">
          Print Request PDF 1 <mat-icon class="icon-control">print</mat-icon>
        </button>
        <br>
        <button mat-raised-button style="margin:1rem;" (click)="printRequest2()">
          Print Request PDF 2 <mat-icon class="icon-control">print</mat-icon>
        </button>
        <div style="display:block;">
          <mat-checkbox
            color="primary"
            [(ngModel)]="personPay"
            [ngModelOptions]="{standalone: true}">Charge Persons
          </mat-checkbox>
          <mat-checkbox
            color="primary"
            [(ngModel)]="vehiclePay"
            style="margin-left:2rem;"
            [ngModelOptions]="{standalone: true}">Charge Vehicles
          </mat-checkbox>
        </div>
      </div>

      <!-- <div *ngIf="editMode" class="print-request" id="print-request">
        <button mat-raised-button style="margin:1rem; margin-top: 0;" (click)="printRequest()">
          Print Request PDF 1 <mat-icon class="icon-control">print</mat-icon>
        </button>
        <br>
        <button mat-raised-button style="margin:1rem;" (click)="printRequest2()">
          Print Request PDF 2 <mat-icon class="icon-control">print</mat-icon>
        </button>
      </div> -->

      <button *ngIf="!editMode"
        mat-raised-button type="submit" color="primary"
        [disabled]="imagesCheck() || !requesterForm.valid || !companyOk"
        class="main-send">Send</button>
      <button type="button" *ngIf="showApproveBtn"
        (click)="approve(request.id)" mat-raised-button color="primary"
        class="main-send">Approve</button>
      <button type="button" *ngIf="showDeclineBtn"
        (click)="decline(request.id)" mat-raised-button color="primary"
        class="main-send">Decline</button>
      <button type="button" *ngIf="showApproveBtn || showDeclineBtn" mat-raised-button color="primary"
        style="float:left; margin:2rem; margin-left:5rem;" (click)="editRequest()">Update</button>
    </form>

  </div>
  <div class="requester-props-container">
    <div class="requester-prop mat-elevation-z8">
      <mat-list dense role="list">
        <mat-list-item *ngFor="let person of requesterService.getAllPersons(); let i = index">
          <div class="list-row">
            <div>
              <span class="person-name">{{person.name}}</span>
              <span class="person-surname">{{person.surname}}</span>
            </div>
            <div>
              <!--  *ngIf="!editMode" -->
              <mat-icon matListIcon
                (click)="editPerson(i)"
                class="icon-control"
                >border_color</mat-icon>
                <!--  *ngIf="!editMode" -->
              <mat-icon matListIcon
                (click)="deletePerson(i)"
                class="icon-control">delete</mat-icon>
            </div>
          </div>
          <mat-divider></mat-divider>
        </mat-list-item>
      </mat-list>
      <button mat-mini-fab *ngIf="!editMode" color="primary" (click)="openPersonDialog()" id="plusPerson">+
      </button>
    </div>
    <div class="requester-prop mat-elevation-z8">
      <mat-list dense role="list">
        <mat-list-item *ngFor="let vehicle of requesterService.getAllVehicles(); let i = index">
          <div class="list-row">
            <div>
              <span class="vehicle-plate">{{vehicle.plate}}</span>
            </div>
            <div>
               <!-- *ngIf="!editMode" -->
              <mat-icon matListIcon
                (click)="editVehicle(i)"
                class="icon-control"
                >border_color</mat-icon>
                 <!-- *ngIf="!editMode" -->
              <mat-icon matListIcon
                (click)="deleteVehicle(i)"
                class="icon-control">delete</mat-icon>
            </div>
          </div>
          <mat-divider></mat-divider>
        </mat-list-item>
      </mat-list>
      <button mat-mini-fab *ngIf="!editMode" color="primary" (click)="openVehicleDialog()" id="plusVehicle">+
      </button>
    </div>
    <div style="text-align:right">
      <!-- <button mat-raised-button class="main-send">Send</button> -->
    </div>
  </div>
</div>
